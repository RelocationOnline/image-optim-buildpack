#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>


BUILD_DIR=$1
CACHE_DIR=$2
BIN_DIR=$(cd $(dirname $0); pwd)
ROOT_DIR=$(dirname $BIN_DIR)
WORKING_DIR=$(pwd)
VENDOR_DIR="vendor"

indent() {
  sed -u 's/^/       /'
}

echo "-----> Adding Item-Optim binaries"

cd $ROOT_DIR/${VENDOR_DIR}

mkdir -p ${BUILD_DIR}/${VENDOR_DIR}

cp -vr ./image-optim ${BUILD_DIR}/${VENDOR_DIR} | indent
export PATH="$PATH:$HOME/vendor/image-optim"

echo "-----> Image-Optim binaries versions"

./image-optim/advpng -V | indent

./image-optim/jpegoptim -V | indent

cd $WORKING_DIR

echo "-----> Adding image-optim binaries to PATH"

cd $ROOT_DIR/profile.d

mkdir -p ${BUILD_DIR}/.profile.d

cp -v * ${BUILD_DIR}/.profile.d/ | indent
